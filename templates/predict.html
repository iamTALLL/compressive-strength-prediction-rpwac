{% extends "base.html" %}
{% block title %}Predict{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="row">
    
    <!-- Left Section -->
    <div class="col-lg-5 mb-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h2 class="card-title">Model Overview</h2>
          <p class="card-text">
            Machine Learning can accurately predict the compressive strength of concrete incorporating recycled plastic aggregates under laboratory conditions.
            The XGBoost model combined with the ZOA optimization algorithm achieves over 90% accuracy, demonstrating strong capability in predicting the mechanical properties of concrete with complex and nonlinear input variables.
          </p>
        </div>
      </div>
    </div>

    <!-- Right Section -->
    <div class="col-lg-7">
      <div class="card shadow-sm">
        <div class="card-body">
          <form method="POST" novalidate>
            
            <div class="row g-3">
              <!-- Cement dosage -->
              <div class="col-md-6">
                <label class="form-label" for="cement_dosage">Cement dosage (c_d) (kg):</label>
                <input type="number" class="form-control" id="cement_dosage" name="cement_dosage" step="any" required>
              </div>

              <!-- Cement compressive strength -->
              <div class="col-md-6">
                <label class="form-label" for="cement_compressive_strength">Cement compressive strength (ce_cs) (MPa):</label>
                <input type="number" class="form-control" id="cement_compressive_strength" name="cement_compressive_strength" step="any" required>
              </div>

              <!-- Cement specific gravity -->
              <div class="col-md-6">
                <label class="form-label" for="cement_specific_gravity">Cement specific gravity (ce_sg) (g/cm³):</label>
                <input type="number" class="form-control" id="cement_specific_gravity" name="cement_specific_gravity" step="any" required>
              </div>

              <!-- Fine aggregate -->
              <div class="col-md-6">
                <label class="form-label" for="fine_aggregate_quantity">Fine aggregate quantity (f_q) (kg):</label>
                <input type="number" class="form-control" id="fine_aggregate_quantity" name="fine_aggregate_quantity" step="any" required>
              </div>

              <!-- Fine aggregate specific gravity -->
              <div class="col-md-6">
                <label class="form-label" for="fine_aggregate_specific_gravity">Fine aggregate specific gravity (f_sg) (g/cm³):</label>
                <input type="number" class="form-control" id="fine_aggregate_specific_gravity" name="fine_aggregate_specific_gravity" step="any" required>
              </div>

              <!-- Coarse aggregate -->
              <div class="col-md-6">
                <label class="form-label" for="coarse_aggregate_quantity">Coarse aggregate quantity (c_q) (kg):</label>
                <input type="number" class="form-control" id="coarse_aggregate_quantity" name="coarse_aggregate_quantity" step="any" required>
              </div>

              <!-- Coarse aggregate specific gravity -->
              <div class="col-md-6">
                <label class="form-label" for="coarse_aggregate_specific_gravity">Coarse aggregate specific gravity (ca_sg) (g/cm³):</label>
                <input type="number" class="form-control" id="coarse_aggregate_specific_gravity" name="coarse_aggregate_specific_gravity" step="any" required>
              </div>

              <!-- Water -->
              <div class="col-md-6">
                <label class="form-label" for="water">Water (w) (kg):</label>
                <input type="number" class="form-control" id="water" name="water" step="any" required>
              </div>

              <!-- Water/cement ratio -->
              <div class="col-md-6">
                <label class="form-label" for="water_cement_ratio">Water/cement ratio (w/c):</label>
                <input type="number" class="form-control" id="water_cement_ratio" name="water_cement_ratio" step="any" required>
              </div>

              <!-- Plastic quantity -->
              <div class="col-md-6">
                <label class="form-label" for="plastic_quantity">Plastic quantity (p_q) (kg):</label>
                <input type="number" class="form-control" id="plastic_quantity" name="plastic_quantity" step="any" required>
              </div>

              <!-- Plastic tensile strength -->
              <div class="col-md-6">
                <label class="form-label" for="plastic_tensile_strength">Plastic tensile strength (p_ts) (MPa):</label>
                <input type="number" class="form-control" id="plastic_tensile_strength" name="plastic_tensile_strength" step="any" required>
              </div>

              <!-- Plastic specific gravity -->
              <div class="col-md-6">
                <label class="form-label" for="plastic_specific_gravity">Plastic specific gravity (p_sg) (g/cm³):</label>
                <input type="number" class="form-control" id="plastic_specific_gravity" name="plastic_specific_gravity" step="any" required>
              </div>

              <!-- Slump -->
              <div class="col-md-6">
                <label class="form-label" for="slump">Slump (cm):</label>
                <input type="number" class="form-control" id="slump" name="slump" step="any" required>
              </div>

              <!-- Concrete specific gravity -->
              <div class="col-md-12">
                <label class="form-label" for="concrete_specific_gravity">Concrete specific gravity (c_sg) (kg/m³):</label>
                <input type="number" class="form-control" id="concrete_specific_gravity" name="concrete_specific_gravity" step="any" required>
              </div>
            </div>

            <div class="mt-4 text-center">
              <button type="submit" class="btn btn-primary px-4">PREDICT</button>
            </div>

            {% if error %}
              <div class="alert alert-danger mt-3">{{ error }}</div>
            {% endif %}

            {% if prediction is not none %}
              <div class="alert alert-success mt-3">
                Predicted Concrete Compressive Strength (c_cs): <strong>{{ prediction | round(2) }}</strong> MPa
              </div>
            {% endif %}
          </form>
        </div>
      </div>

      <!-- CSV Upload -->
      <div class="card shadow-sm mt-4">
        <div class="card-body">
          <h4>Or Batch Predict from CSV</h4>
          <form method="POST" action="{{ url_for('predict_csv') }}" enctype="multipart/form-data">
            <input type="file" name="file" accept=".csv" class="form-control mb-2" required>
            <button type="submit" class="btn btn-secondary">UPLOAD & PREDICT CSV</button>
          </form>

          {% if predictions %}
            <div class="mt-3">
              <h5>Batch Predictions:</h5>
              <div class="table-responsive">
                {{ predictions | safe }}
              </div>
            </div>
          {% endif %}
        </div>
      </div>
    </div>

  </div>
</div>
{% endblock %}

{% extends "base.html" %}

{% block title %}Inverse Design{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="text-center section-title mb-4">üß™ Inverse Design: T·ªëi ∆Øu H√≥a C√¥ng Th·ª©c B√™ T√¥ng</h1>
    <p class="text-center text-muted">S·ª≠ d·ª•ng thu·∫≠t to√°n FOX (m·ªôt bi·∫øn th·ªÉ c·ªßa GA) ƒë·ªÉ t√¨m ra c√¥ng th·ª©c v·∫≠t li·ªáu t·ªëi ∆∞u, ƒë√°p ·ª©ng c∆∞·ªùng ƒë·ªô n√©n m·ª•c ti√™u (Target CS) trong khi t·ªëi thi·ªÉu h√≥a xi mƒÉng v√† t·ªëi ƒëa h√≥a nh·ª±a t√°i ch·∫ø.</p>

    {% if error %}
    <div class="alert alert-danger" role="alert">
        <strong>L·ªói / C·∫£nh b√°o:</strong> {{ error }}
    </div>
    {% endif %}
    
    {% if not optimize_enabled %}
    <div class="alert alert-warning" role="alert">
        <strong>C·∫£nh b√°o:</strong> T√≠nh nƒÉng Inverse Design (T·ªëi ∆∞u h√≥a) ƒë√£ b·ªã v√¥ hi·ªáu h√≥a do kh√¥ng t√¨m th·∫•y th∆∞ vi·ªán <code>mealpy</code>. Vui l√≤ng ki·ªÉm tra c√†i ƒë·∫∑t.
    </div>
    {% endif %}

    {% if optimize_enabled %}
    <div class="card shadow-sm mb-5">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Tham S·ªë T·ªëi ∆Øu H√≥a</h5>
        </div>
        <div class="card-body">
            <form method="POST">
                
                <div class="row mb-4 border-bottom pb-3">
                    <div class="col-md-12">
                        <h4>1. Target Compressive Strength (M·ª•c ti√™u C∆∞·ªùng ƒë·ªô N√©n)</h4>
                        <div class="form-group">
                            <label for="target_cs" class="font-weight-bold">Target CS (MPa):</label>
                            <input type="number" step="0.01" name="target_cs" id="target_cs" class="form-control" required 
                                   value="{{ request.form.get('target_cs', 45) }}" min="10" max="90"
                                   placeholder="V√≠ d·ª•: 45.0">
                            <small class="form-text text-muted">Gi√° tr·ªã m·ª•c ti√™u cho c∆∞·ªùng ƒë·ªô n√©n (10 - 90 MPa).</small>
                        </div>
                    </div>
                </div>

                <h4>2. Fixed Components (R√†ng bu·ªôc c·ªë ƒë·ªãnh)</h4>
                <p class="text-muted">Nh·∫≠p gi√° tr·ªã (kg/m¬≥) cho c√°c th√†nh ph·∫ßn b·∫°n mu·ªën gi·ªØ c·ªë ƒë·ªãnh. ƒê·ªÉ tr·ªëng ho·∫∑c nh·∫≠p **0** ƒë·ªÉ thu·∫≠t to√°n FOX t·ªëi ∆∞u h√≥a gi√° tr·ªã ƒë√≥.</p>
                
                <div class="row">
                    {% for feat in all_features %}
                    <div class="col-md-3 col-sm-6 mb-3">
                        <div class="form-group">
                            <label for="{{ feat }}" class="small text-muted">{{ name_map[feat] }} ({{ feat }}):</label>
                            <input type="number" step="0.0001" name="{{ feat }}" id="{{ feat }}" class="form-control form-control-sm" 
                                   placeholder="0 (Optimize)">
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <div class="text-center mt-4">
                    <button type="submit" class="btn btn-success btn-lg">
                        <i class="fas fa-magic"></i> Run Optimization
                    </button>
                </div>
            </form>
        </div>
    </div>
    {% endif %}


    {% if predicted_cs %}
    <div class="card shadow-lg mb-5 border-success">
        <div class="card-header bg-success text-white">
            <h5 class="mb-0"><i class="fas fa-check-circle"></i> K·∫øt Qu·∫£ C√¥ng Th·ª©c T·ªëi ∆Øu</h5>
        </div>
        <div class="card-body">
            <div class="row text-center mb-4">
                <div class="col-md-6 border-right">
                    <p class="mb-1 text-muted">Target Compressive Strength</p>
                    <h2 class="display-4 text-primary">{{ target_cs }} MPa</h2>
                </div>
                <div class="col-md-6">
                    <p class="mb-1 text-muted">Predicted CS (Optimized Mix)</p>
                    <h2 class="display-4 text-success">{{ predicted_cs }} MPa</h2>
                </div>
            </div>
            
            <h5 class="mt-4 border-top pt-3">Chi Ti·∫øt Th√†nh Ph·∫ßn T·ªëi ∆Øu (kg/m¬≥)</h5>
            <div class="table-responsive">
                <table class="table table-bordered table-hover results-table">
                    <thead class="thead-light">
                        <tr>
                            <th>Th√†nh Ph·∫ßn</th>
                            <th>T√™n vi·∫øt t·∫Øt</th>
                            <th>Gi√° Tr·ªã T·ªëi ∆Øu (kg/m¬≥)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for name, value in optimized_list %}
                        <tr>
                            <td>{{ name }}</td>
                            <td>{{ all_features[loop.index0] }}</td>
                            <td><strong>{{ value }}</strong></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <div class="alert alert-info small mt-3">
                <i class="fas fa-info-circle"></i> 
                M·ª•c ti√™u c·ªßa thu·∫≠t to√°n l√† t√¨m c√¥ng th·ª©c c√≥ t·ªïng th·ªÉ t√≠ch x·∫•p x·ªâ 1 m¬≥, t·ªëi thi·ªÉu h√≥a Xi mƒÉng ({{ L1 }} * c_d), v√† t·ªëi ƒëa h√≥a Nh·ª±a ({{ L2 }} * p_q), trong khi c∆∞·ªùng ƒë·ªô n√©n g·∫ßn v·ªõi Target CS nh·∫•t.
            </div>
        </div>
    </div>
    {% endif %}

</div>
{% endblock %}